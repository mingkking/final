<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mgr.dao.MgrDAO">

   <!-- session 생성 시 데이터 저장(방문자 데이터) -->
   <insert id="saveSession" parameterType="MgrSessionCountVO">
      INSERT INTO countVisit(sessionId, creationTime)
      VALUES(#{sessionId}, TRUNC(SYSDATE))
   </insert>
   
   <!-- 총 방문자 수  -->
   <select id="selectTotalSession" parameterType="MgrSessionCountVO" resultType="int">
      SELECT count(*)
      FROM countVisit
   </select>
   
   <!-- 오늘 방문자 수 -->
   <select id="selectTodaySession" parameterType="MgrSessionCountVO" resultType="int">
      SELECT count(*)
      FROM countVisit
      WHERE TRUNC(creationTime) = TRUNC(SYSDATE)
   </select>
   
   <!-- 한 달 방문자 수 -->
   <select id="selectMonthSession" parameterType="MgrSessionCountVO" resultType="int">
      SELECT count(*)
      FROM countVisit
      WHERE creationTime BETWEEN TRUNC(SYSDATE) - INTERVAL '1' MONTH AND TRUNC(SYSDATE)
   </select>
   
   <!-- 회원 수 -->
   <select id="selectTotalMembers" parameterType="MgrMemberVO" resultType="int">
      SELECT count(*)
      FROM users
   </select>
   
   <!-- 금일 회원가입 수 -->
   <select id="selectTodayMembers" parameterType="MgrMemberVO" resultType="int">
      SELECT count(*)
      FROM users
      WHERE TRUNC(created_at) = TRUNC(SYSDATE)
   </select>
    
    <!-- 구독자 수 -->
    <select id="selectTotalSubscribers" parameterType="MgrSubscriberCountVO" resultType="int">
    	SELECT count(*)
    	FROM subscribe
    </select>
    
    <!-- 회원 목록 리스트 출력 -->
    <select id="selectMembers" resultType="MgrMemberVO">
    	SELECT *
    	FROM users
    	ORDER BY user_num DESC
    </select>
    
    <!-- memberDetail 출력(회원상세보기) -->
    <select id="selectMemberDetail" resultType="MgrMemberVO">
    	SELECT *
    	FROM users
    	WHERE user_num = #{user_num}
    </select>
</mapper>

